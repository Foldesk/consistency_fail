#!/usr/bin/env ruby

require "consistency_fail"

engine = ConsistencyFail::Engine.new
engine.preload_all_models

validates_uniqueness_of_problems = engine.models.map do |m|
  [m, engine.missing_indexes_for_validates_uniqueness_on(m)]
end.reject do |m, indexes|
  indexes.empty?
end

#has_one_problems = engine.models.map do |m|
#  [m, engine.missing_indexes_for_has_one_on(m)]
#end.reject do |m, indexes|
#  indexes.empty?
#end

reporter = ConsistencyFail::Reporter.new
reporter.report_validates_uniqueness_problems(validates_uniqueness_of_problems)

#reporter.report_has_one_problems(has_one_problems)

