#!/usr/bin/env ruby

require "consistency_fail"

def problems(models, introspector)
  problems = models.map do |m|
    [m, introspector.missing_indexes(m)]
  end.reject do |m, indexes|
    indexes.empty?
  end
end

models = ConsistencyFail::Models.new($LOAD_PATH)
models.preload_all

reporter = ConsistencyFail::Reporter.new

introspector = ConsistencyFail::Introspectors::ValidatesUniquenessOf.new
problems = problems(models.all, introspector)
reporter.report_validates_uniqueness_problems(problems)

introspector = ConsistencyFail::Introspectors::HasOne.new
problems = problems(models.all, introspector)
reporter.report_has_one_problems(problems)

